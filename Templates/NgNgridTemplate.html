<div ng-style="getStyle()">
    <nav id="ngGridToolbar" class="navbar-form navbar-default navbar-static-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-left">
                <span class="btn-toolbar">
                    <span class="btn-group">
                        <label class="btn btn-default" btn-checkbox ng-model="hideSettings" data-toggle="tooltip" data-placement="right" title="Show/Hide Settings">
                            <span class="glyphicon glyphicon-cog"></span>
                            <span ng-class="hideSettings?'ngngrid-caret-left':'ngngrid-caret-right'"></span>
                        </label>
                    </span>
                    <span class="btn-group" ng-show="hideSettings">
                        <label class="btn btn-default" btn-checkbox ng-model="showRowNumbers" data-toggle="tooltip" data-placement="right" title="Show/Hide Row Numbers">
                            <span class="glyphicon" ng-class="showRowNumbers?'glyphicon-check':'glyphicon-unchecked'"></span> Row #
                        </label>
                        <label class="btn btn-default" btn-checkbox ng-model="showRowSelector" data-toggle="tooltip" data-placement="right" title="Show/Hide Row Selector">
                            <span class="glyphicon" ng-class="showRowSelector?'glyphicon-check':'glyphicon-unchecked'"></span> Selectable Rows
                        </label>
                        <label class="btn btn-default" btn-checkbox ng-model="showChildrenCount" data-toggle="tooltip" data-placement="right" title="Show/Hide Children Count">
                            <span class="glyphicon" ng-class="showChildrenCount?'glyphicon-check':'glyphicon-unchecked'"></span> Child Record Count
                        </label>
                    </span>
                    <span class="btn-group" ng-show="hideSettings">
                        <label class="btn btn-danger" ng-click="clearAllFilters()" ng-disabled="!anyFiltersExist()" data-toggle="tooltip" data-placement="right" title="Clear All Filters">
                            Clear all <span class="glyphicon glyphicon-filter"></span>
                        </label>
                    </span>
                    <span class="btn-group" ng-show="hideSettings">
                        <input id="fileUploadJson" class="form-control btn btn-default" type="file" accept=".json" onchange="angular.element(this).scope().on_fileUpload(this)" style="display:none" />
                        <label class="btn btn-primary" ng-click="importFromJson()" data-toggle="tooltip" data-placement="right" title="Import grid rows from json file">
                            Import <span class="glyphicon glyphicon-import"></span>
                        </label>
                        <label class="btn btn-primary" ng-disabled="!isAnyRowSelected()" ng-click="exportSelectedToJson()" data-toggle="tooltip" data-placement="right" title="Export selected rows to json file">
                            Export Selected <span class="glyphicon glyphicon-export"></span>
                        </label>
                    </span>
                </span>
            </div>
            <div class="navbar-right">
                <span class="btn-group">
                    <label class="btn" onmouseover="" style="cursor:default"><b>{{gridCurrentPage}}-{{gridTotalPages()}}</b> of <b>{{rows.length}}</b></label>
                    <span>
                        <pagination class="pagination" onmouseover="" style="cursor: pointer;margin:0" boundary-links="true" total-items="rows.length" ng-model="gridCurrentPage" items-per-page="gridPageSize" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;" max-size="5" rotate=""></pagination>
                    </span>
                </span>
                <span class="input-group" style="margin-top:-6px" data-toggle="tooltip" data-placement="right" title="Records per Page">
                    <span class="input-group-addon">
                        <span class=" glyphicon glyphicon-th-list"></span>
                    </span>
                    <select class="form-control" ng-model="gridPageSize" ng-options="number for number in pageSizeOptions"></select>
                </span>
            </div>
        </div>
    </nav>
    <div class="ngngrid-scroll" ng-style="setGridTableStyle()">
        <table id="ngGridTable" class="table table-condensed table-bordered table-striped">
            <tr>
                <th ng-if="childColumndefinitions.length > 0" class="bg-primary"></th>
                <th ng-show="showRowNumbers" class="bg-primary">#</th>
                <th ng-show="showRowSelector" ng-click="toggleRowsSelect()" style="cursor:pointer" data-toggle="tooltip" title="Select/Unselect All" class="bg-primary">
                    <span class="glyphicon" ng-class="allRowsSelected ? 'glyphicon-check': 'glyphicon-unchecked'"></span>
                </th>
                <th ng-repeat="c in columnDefinitions" ng-hide="c.isNgNgridColumnHide" class="bg-primary">
                    <!--<div ng-click="c.isNgNgridColumnHide = true" style="cursor:pointer" data-toggle="tooltip" title="Hide Column" class="glyphicon glyphicon-remove-sign"></div>-->
                    <span ng-click="changeSort(c)" style="cursor:pointer">
                        <u>{{c.DisplayName}}</u>
                        <span ng-show="isSorted(c)" class="glyphicon" ng-class="gridSortOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></span>
                    </span>
                </th>
            </tr>
            <tr>
                <th ng-if="childColumndefinitions.length > 0"></th>
                <th ng-show="showRowNumbers"></th>
                <th ng-show="showRowSelector"></th>
                <th ng-repeat="c in columnDefinitions" ng-hide="c.isNgNgridColumnHide">
                    <div ng-hide="c.DisableFilter" class="input-group input-group-sm dropdown" dropdown auto-close="outsideClick" is-open="c.isNgNgridDropdownOpen" on-toggle="ondropDownToggle(c,'ngNgridDropdownFilter' + $index)">
                        <input type="text" class="form-control" ng-model="dropDownFilterInput" ng-init="dropDownFilterInput=''" ng-focus="c.isNgNgridDropdownOpen=true" id="ngNgridDropdownFilter{{$index}}" ng-keypress="dropdownFilterKeyPress($event,c)" />
                        <span class="input-group-btn">
                            <button type="button" dropdown-toggle class="btn dropdown-toggle" ng-class="isColFilterApplied(c) ? 'btn-primary':'btn-default'">
                                <span class="glyphicon glyphicon-filter"></span>
                            </button>
                        </span>
                        <ul class="dropdown-menu" ng-class="$index==columnDefinitions.length-1 ? 'dropdown-menu-right' :''" role="menu" style="overflow-y:auto;max-height:500px;width:auto;overflow-x:auto">
                            <li class="ngngrid-dropdown"><small class="text-muted">*Type & hit Enter to apply filters</small></li>
                            <li class="divider"></li>
                            <li class="ngngrid-dropdown">
                                <span class="input-group input-group-sm">
                                    <span class="glyphicon" ng-class="isColFilterApplied(c)?'glyphicon-check':'glyphicon-unchecked'" style="cursor: pointer" ng-click="toggleColFilters(c);$event.stopPropagation()"></span>
                                    <span>Select/Unselect All</span>
                                </span>
                            </li>
                            <li ng-if="c.ColumnType=='ngNGridDate' || c.ColumnType=='ngNGridNumber'" class="divider"></li>
                            <span ng-if="c.ColumnType=='ngNGridDate'">
                                <span class="input-group">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                    <input type="date" class="form-control" datepicker-popup ng-model="ngNgridStartDate" is-open="datepickerstartopen" date-disabled="false" ng-required="true" close-text="Close" datepicker-append-to-body="true" ng-click="datepickerstartopen=true" placeholder="From" ng-change="updateDateFilter(c,ngNgridStartDate,ngNgridEndDate)" />
                                </span>
                                <!--<span class="input-group-btn">
                <button type="button" class="btn btn-default" ng-click="datepickeropen=true"><span class="glyphicon glyphicon-calendar"></span></button>
            </span>-->
                                <div></div>
                                <span class="input-group">
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                    <input type="date" class="form-control" datepicker-popup ng-model="ngNgridEndDate" is-open="datepickerendopen" date-disabled="false" ng-required="true" close-text="Close" datepicker-append-to-body="true" ng-click="datepickerendopen=true" placeholder="To" ng-change="updateDateFilter(c,ngNgridStartDate,ngNgridEndDate)" />
                                </span>
                            </span>
                            <span ng-if="c.ColumnType=='ngNGridNumber'">
                                <span class="input-group">
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-step-backward"></span>
                                    </span>
                                    <input type="number" class="form-control" ng-model="ngNgridStartNumber" ng-required="true" placeholder="From" ng-change="updateRangeFilter(c,ngNgridStartNumber,ngNgridEndNumber)" />
                                </span>
                                <div></div>
                                <span class="input-group">
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-step-forward"></span>
                                    </span>
                                    <input type="number" class="form-control" ng-model="ngNgridEndNumber" ng-required="true" placeholder="To" ng-change="updateRangeFilter(c,ngNgridStartNumber,ngNgridEndNumber)" />
                                </span>
                            </span>

                            <li class="divider"></li>
                            <li ng-repeat="distinctObj in (c.DropdownFilteredObjects = (distinctLists[getSortProperty(c)] | filter:{DisplayValue:dropDownFilterInput}:false)) | orderBy:false" class="ngngrid-dropdown">
                                <span class="glyphicon" ng-class="isColFiltered(c,distinctObj.DistinctValue)?'glyphicon-check':'glyphicon-unchecked'" ng-click="addColumnFilters(c,[distinctObj.DistinctValue]);$event.stopPropagation()" style="cursor: pointer"></span>
                                <small style="font-weight:normal">
                                    <span ng-class="c.FilterClassFn(distinctObj)" style="margin-right:2px">                                        
                                        {{(distinctObj.DisplayValue != null && distinctObj.DisplayValue.toString() != '') ? distinctObj.DisplayValue : '(Blanks)'}}
                                        <span class="glyphicon" ng-class="c.FilterGlyphFn(distinctObj)"></span>
                                    </span>
                                    <span class="text-muted">({{distinctObj.DistinctCount}})</span>
                                </small>
                            </li>
                        </ul>
                    </div>
                </th>
            </tr>
            <tr ng-repeat-start="row in (gridFilteredRows =  (rows | orderBy:gridSortColumn:gridSortOrder | filter:canShowRecord)) | ngNgridPageOffset: (gridCurrentPage-1)*gridPageSize  | limitTo:gridPageSize" style="border-bottom: none" ng-class="{'ngngrid-animaterow':row.isNgNgridUpdated,'info':row.isNgNgridSelected,'warning':row.isNgNgridDirty}">
                <td ng-if="childColumndefinitions.length > 0">
                    <span ng-click="row.isNgNgridOpen = !row.isNgNgridOpen" ng-disabled="childRowsCount(row) <= 0" data-toggle="tooltip" title="{{row.isNgNgridOpen?'Collapse Details':'Expand Details'}}" style="cursor:pointer">
                        <span class="glyphicon" ng-class="row.isNgNgridOpen?'glyphicon-minus-sign':'glyphicon-plus-sign'"></span>
                        <sub ng-show="showChildrenCount">{{childRowsCount(row)}}</sub>
                    </span>
                </td>
                <td ng-show="showRowNumbers">{{$index+1}}</td>
                <td ng-show="showRowSelector" ng-click="row.isNgNgridSelected = !row.isNgNgridSelected" style="cursor:pointer" data-toggle="tooltip" title="Select/Unselect Row">
                    <span class="glyphicon" ng-class="row.isNgNgridSelected ?  'glyphicon-check': 'glyphicon-unchecked'"></span>
                </td>
                <td ng-repeat="c in columnDefinitions" ng-class="c.CellClassFn(row)" ng-hide="c.isNgNgridColumnHide">
                    <span ng-show="$index ==0 && row.isNgNgridDirty" class='glyphicon glyphicon-edit'></span>
                    <span ng-switch="c.ColumnType">



                        <label ng-switch-when="ngNGridLabel" class="label {{c.ClassFn(row)}}" data-toggle="tooltip" data-placement="right" title="{{c.TooltipFn(row)}}">
                            <span class="glyphicon {{c.GlyphFn(row)}}"></span>
                            {{c.TextFn ?  c.TextFn(row) :  row[c.Name]}}
                            <span ng-show="c.BadgeFn" class="badge" ng-class="c.BadgeClass">{{c.BadgeFn(row)}}</span>
                        </label>
                        <button ng-switch-when="ngNGridButton" ng-disabled="c.DisabledFn(row)" class="btn  btn-xs  {{c.ClassFn(row)}}" data-toggle="tooltip" data-placement="right" title="{{c.TooltipFn(row)}}" ng-click="c.ClickFn(row)">
                            <span class="glyphicon  {{c.GlyphFn(row)}}"></span>
                            {{c.TextFn ?  c.TextFn(row) :  row[c.Name]}}
                            <span ng-show="c.BadgeFn" class="badge" ng-class="c.BadgeClass">{{c.BadgeFn(row)}}</span>
                        </button>
                        <span ng-switch-when="ngNGridDate" ng-class="c.ClassFn ? c.ClassFn(row) : ''">
                            <span class="glyphicon  {{c.GlyphFn(row)}}"></span>
                            {{c.TextFn ?  c.TextFn(row) :  row[c.Name]|date:c.DateFormatFn(row)}}
                            <span ng-show="c.BadgeFn" class="badge">{{c.BadgeFn(row)}}</span>
                        </span>
                        <span ng-switch-when="ngNGridSelect" class="input-group input-group-sm">
                            <span ng-show="c.ClassFn" class="input-group-addon" ng-class="c.ClassFn(row)">
                                <span class="glyphicon" ng-class="c.GlyphFn(row)"></span>
                            </span>
                            <select ng-if="c.SelectValue != null" class="form-control" ng-model="row[c.Name]" ng-options="o[c.SelectValue]  for o in  c.SelectFn(row)  track by o[c.SelectKey]" ng-change="row.isNgNgridDirty=true" required>
                                <option value="">Select</option>
                            </select>
                            <select ng-if="c.SelectValue == null" class="form-control" ng-model="row[c.Name]" ng-options="o  for o in  c.SelectFn(row)  track by o" ng-change="row.isNgNgridDirty=true" required>
                                <option value="">Select</option>
                            </select>
                        </span>
                        <a ng-switch-when="ngNGridLink" href="{{c.UrlFn(row)}}" target="{{c.TargetFn ? c.TargetFn(row):'_blank'}}" ng-class="c.ClassFn(row)">
                            <span class="glyphicon  {{c.GlyphFn(row)}}"></span>
                            {{c.TextFn ?  c.TextFn(row) :  row[c.Name]}}
                            <span ng-show="c.BadgeFn" class="badge" ng-class="c.BadgeClass">{{c.BadgeFn(row)}}</span>
                        </a>
                        <span ng-switch-when="ngNGridInput" ng-class="c.GlyphFn?'input-group':''">
                            <span ng-show="c.GlyphFn" class="input-group-addon" ng-class="c.ClassFn(row)">
                                <span class="glyphicon" ng-class="c.GlyphFn(row)"></span>
                            </span>
                            <input class="form-control" ng-model="row[c.Name]" ng-readonly="c.DisabledFn(row)" ng-change="row.isNgNgridDirty=true" placeholder="{{c.NullOrEmptyFn(row)}}" type="{{c.InputTypeFn(row)}}" />
                        </span>
                        <span ng-switch-default ng-class="c.ClassFn ? c.ClassFn(row) : ''">
                            <span class="glyphicon {{c.GlyphFn(row)}}"></span>
                            {{c.TextFn ?  c.TextFn(row) :  row[c.Name]}}
                            <span ng-show="c.BadgeFn" class="badge" ng-class="c.BadgeClass">{{c.BadgeFn(row)}}</span>
                        </span>
                        <img ng-show="c.ImgFn" ng-class="c.ImgClassFn(row)" src="{{c.ImgFn(row)}}" />
                    </span>
                </td>
            </tr>
            <tr ng-repeat-end ng-if="row.isNgNgridOpen" ng-class="{'ngngrid-animaterow':row.isNgNgridUpdated,'info':row.isNgNgridSelected,'warning':row.isNgNgridDirty}">
                <td></td>
                <td ng-show="showRowNumbers"></td>
                <td ng-show="showRowSelector"></td>
                <td colspan="{{columnDefinitions.length}}">
                    <table class="table table-condensed table-bordered table-striped" ng-repeat="childColDef in childColumndefinitions">
                        <tr>
                            <th ng-repeat="childCol in childColDef">
                                <span ng-click="changeChildSort(childCol)" style="cursor:pointer">
                                    <u>
                                        {{childCol.DisplayName}}
                                    </u>
                                    <span ng-show="isChildSorted(childCol)" class="glyphicon" ng-class="gridChildrenSortOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></span>
                                </span>
                            </th>
                        </tr>
                        <tr ng-repeat="childRow in getChildRows(row,childPropertynames[$index]) | orderBy:gridChildrenSortColumn:gridChildrenSortOrder" ng-class="{'ngngrid-animaterow':childRow.isNgNgridUpdated,'info':childRow.isNgNgridSelected,'warning':childRow.isNgNgridDirty}">
                            <td ng-repeat="childCol in childColDef" ng-class="childCol.CellClassFn(childRow)">
                                <span ng-show="$index ==0 && childRow.isNgNgridDirty" class='glyphicon glyphicon-edit'></span>
                                <span ng-switch="childCol.ColumnType">
                                    <label ng-switch-when="ngNGridLabel" class="label label-xs {{childCol.ClassFn(childRow)}}" data-toggle="tooltip" data-placement="right" title="{{childCol.TooltipFn(childRow)}}">
                                        <span class="glyphicon {{childCol.GlyphFn(childRow)}}"></span>
                                        {{childCol.TextFn ?  childCol.TextFn(childRow) :  childRow[childCol.Name]}}
                                        <span ng-show="childCol.BadgeFn" class="badge" ng-class="childCol.BadgeClass">{{childCol.BadgeFn(childRow)}}</span>
                                    </label>
                                    <button ng-switch-when="ngNGridButton" ng-disabled="childCol.DisabledFn(childRow)" class="btn  btn-xs  {{childCol.ClassFn(childRow)}}" data-toggle="tooltip" data-placement="right" title="{{childCol.TooltipFn(childRow)}}" ng-click="childCol.ClickFn(childRow)">
                                        <span class="glyphicon  {{childCol.GlyphFn(childRow)}}"></span>
                                        {{childCol.TextFn ?  childCol.TextFn(childRow) :  childRow[childCol.Name]}}
                                        <span ng-show="childCol.BadgeFn" class="badge" ng-class="childCol.BadgeClass">{{childCol.BadgeFn(childRow)}}</span>
                                    </button>
                                    <span ng-switch-when="ngNGridDate" ng-class="childCol.ClassFn ? childCol.ClassFn(childRow) : ''">
                                        <span class="glyphicon  {{childCol.GlyphFn(childRow)}}"></span>
                                        {{childCol.TextFn ?  childCol.TextFn(childRow) :  childRow[childCol.Name]|date:childCol.DateFormatFn(childRow)}}
                                        <span ng-show="childCol.BadgeFn" class="badge" ng-class="childCol.BadgeClass">{{childCol.BadgeFn(childRow)}}</span>
                                    </span>
                                    <span ng-switch-when="ngNGridSelect" class="input-group">
                                        <span ng-show="childCol.ClassFn" class="input-group-addon" ng-class="childCol.ClassFn(row)">
                                            <span class="glyphicon" ng-class="childCol.GlyphFn(row)"></span>
                                        </span>
                                        <select ng-if="childCol.SelectValue != null" name="status" ng-disabled="childCol.DisabledFn(childRow)" class="form-control" ng-model="childRow[childCol.Name]" ng-options="o[childCol.SelectValue]  for o in  childCol.SelectFn(childRow)  track by o[childCol.SelectKey]" ng-change="childRow.isNgNgridDirty=true" required>
                                            <option value="">Select</option>
                                        </select>
                                        <select ng-if="childCol.SelectValue == null" name="status" ng-disabled="childCol.DisabledFn(childRow)" class="form-control" ng-model="childRow[childCol.Name]" ng-options="o  for o in  childCol.SelectFn(childRow)  track by o" ng-change="childRow.isNgNgridDirty=true" required>
                                            <option value="">Select</option>
                                        </select>
                                    </span>
                                    <a ng-switch-when="ngNGridLink" href="{{childCol.UrlFn(childRow)}}" target="_blank">
                                        <span class="glyphicon  {{childCol.GlyphFn(childRow)}}"></span>
                                        {{childCol.TextFn ?  childCol.TextFn(childRow) :  childRow[childCol.Name]}}
                                        <span ng-show="childCol.BadgeFn" class="badge" ng-class="childCol.BadgeClass">{{childCol.BadgeFn(childRow)}}</span>
                                    </a>
                                    <span ng-switch-when="ngNGridInput" ng-class="childCol.GlyphFn?'input-group':''">
                                        <span ng-show="childCol.GlyphFn" class="input-group-addon" ng-class="childCol.ClassFn(row)">
                                            <span class="glyphicon" ng-class="childCol.GlyphFn(row)"></span>
                                        </span>
                                        <input class="form-control" ng-model="childRow[childCol.Name]" ng-readonly="childCol.DisabledFn(childRow)" ng-change="childRow.isNgNgridDirty=true" placeholder="{{childCol.NullOrEmptyFn(childRow)}}" type="{{childCol.InputTypeFn(childRow)}}" />
                                    </span>
                                    <span ng-switch-default ng-class="childCol.ClassFn ? childCol.ClassFn(childRow) : ''">
                                        {{childCol.TextFn ?  childCol.TextFn(childRow) :  childRow[childCol.Name]}}
                                        <span class="glyphicon {{childCol.GlyphFn(childRow)}}"></></span>
                                        <span ng-show="childCol.BadgeFn" class="badge" ng-class="childCol.BadgeClass">{{childCol.BadgeFn(childRow)}}</span>
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </table>
                    <table class="table table-condensed table-bordered table-striped" ng-if="rowFooterdefinitions.length > 0">
                        <tr ng-repeat="rowFooter in rowFooterdefinitions">
                            <td ng-repeat="footerItem in rowFooter">
                                <span ng-switch="footerItem.ColumnType">
                                    <span ng-switch-when="ngNGridButton">
                                        <span class="btn-group">
                                            <button class="btn {{footerItem.ClassFn(row)}}" data-toggle="tooltip" data-placement="right" title="{{footerItem.TooltipFn(row)}}" ng-click="footerItem.ClickFn(row)" ng-disabled="footerItem.DisabledFn(row)">
                                                <span class="glyphicon {{footerItem.GlyphFn(row)}}"></span>
                                                <span ng-show="footerItem.BadgeFn" class="badge" ng-class="footerItem.BadgeClass">{{footerItem.BadgeFn(row)}}</span>
                                                {{footerItem.TextFn(row)}}
                                            </button>
                                        </span>
                                    </span>
                                    <span ng-switch-when="ngNGridLabel">
                                        <span class="label label-xs {{footerItem.ClassFn(row)}}" data-toggle="tooltip" data-placement="right" title="{{footerItem.TooltipFn(row)}}">
                                            <span class="glyphicon {{footerItem.GlyphFn(row)}}"></span>
                                            <span ng-show="rowFooter.BadgeFn" class="badge" ng-class="footerItem.BadgeClass">{{footerItem.BadgeFn(row)}}</span>
                                            {{footerItem.TextFn(row)}}
                                        </span>
                                    </span>
                                    <span ng-switch-default ng-class="footerItem.ClassFn(row)">
                                        {{footerItem.TextFn(row)}}
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <progressbar ng-show="rowsLoading" class="active progress-striped" value="100" type="primary">
            <b><i>{{rowsLoadingText}}</i></b>
        </progressbar>
    </div>
</div>
